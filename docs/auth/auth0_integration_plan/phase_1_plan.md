### Summary
Revised patch plan for Phase 1: Implement Auth0 JWT verification with JWKS fetch/cache, integrate into middleware for 401/403 handling, and add basic auth metrics via counters and logging. Emphasize fail-closed auth, strict validation, and fallback mitigations to minimize security risks.

| file | op | functions/APIs | tests | perf/mem budget | risk |
| --- | --- | --- | --- | --- | --- |
| server/auth/providers/auth0.py | create | class Auth0Provider(fetch_jwks with timeout/cache, verify_jwt with strict RS256/audience checks) | tests/unit/auth/test_auth0_provider.py: test_fetch_jwks_success/failure, test_verify_valid/invalid/expired_jwt, test_cache_invalidation | JWKS fetch &lt;2s with 5s timeout, verify &lt;10ms, cache 512KB with 1h TTL | Mitigated JWKS downtime via cache + offline fallback mock in dev |
| server/auth/providers/__init__.py | modify | add Auth0Provider import/factory with config validation | tests/unit/auth/test_providers_init.py: test_auth0_factory_valid/invalid_config | negligible | Graceful failure on import/config errors with logging/alerts |
| server/auth/middleware.py | modify | update require_auth to verify_jwt first, fallback to session only if configured, add 401/403 JSON handlers | tests/unit/auth/test_middleware.py: test_jwt_auth_valid/invalid/expired, test_session_fallback_disabled, test_401_403_responses, test_auth_bypass_attempts | +5ms per request, negligible mem | Mitigated bypass via fail-closed (no fallback in prod) and audit logging |
| server/bas_server.py | modify | init Auth0Provider from validated env in _build_auth_provider_from_env, enforce prod mode | tests/unit/test_bas_server.py: test_auth_provider_init_prod/ invalid_env, test_no_mock_in_prod | negligible | Strict env validation prevents mock in prod; fallback to deny-all on init failure |
| server/http/routes.py | modify | audit/add require_auth to all protected routes with consistent required_role | tests/unit/http/test_routes.py: test_protected_route_jwt_valid/invalid, test_unauth_401_consistency, test_role_based_403 | negligible | Inconsistent auth mitigated by full route audit and contract tests |
| server/services/firestore/telemetry_store.py | modify | add auth_event storage with async writes (success/failure/attempts) | tests/unit/services/test_telemetry_store.py: test_store_auth_event_success/failure, test_async_write_resilience | &lt;50ms write (async), 1KB per event | Mitigated write failures via local buffering + retry queue |
| server/bas_server.py | modify | add metrics counters in setup_auth_context (attempts, failures, latencies) with low-overhead impl | tests/unit/test_bas_server.py: test_auth_metrics_collection_under_load, test_no_overhead | &lt;1ms overhead, 100KB mem | Optimized counters prevent perf risks; use sampling on high traffic |
